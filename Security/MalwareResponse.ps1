#Open Powershell as ADMIN
#Replace Powershell lines as needed w/ correct info

#Check for running malicious processes matching suspicious executable name
Get-CimInstance Win32_Process -Filter "Name LIKE 'SUSPICIOUS_NAME%.exe'" |
Select-Object Name, ProcessId, ExecutablePath, CommandLine |
Format-List


#If processes are found, terminate them immediately
Get-Process | Where-Object { $_.Name -like "SUSPICIOUS_NAME*" } | Stop-Process -Force


#Define affected user profile path
$u = "C:\Users\<AFFECTED_USER>"


#Search common download and desktop locations for malicious executables
Get-ChildItem "$u\Downloads", "$u\Desktop" -Filter "SUSPICIOUS_NAME_*.exe" -Recurse -ErrorAction SilentlyContinue


#Search AppData for additional copies
Get-ChildItem "$u\AppData" -Filter "SUSPICIOUS_NAME_*.exe" -Recurse -ErrorAction SilentlyContinue


#Search ProgramData for additional copies
Get-ChildItem "C:\ProgramData" -Filter "SUSPICIOUS_NAME_*.exe" -Recurse -ErrorAction SilentlyContinue


#Search Temp directories for additional copies
Get-ChildItem $env:TEMP, "C:\Windows\Temp" -Filter "SUSPICIOUS_NAME_*.exe" -Recurse -ErrorAction SilentlyContinue


#Get-FileHash "FULL\PATH\TO\FILE.exe" -Algorithm SHA256
Get-FileHash "FULL\PATH\TO\FILE.exe" -Algorithm SHA256


#Remove confirmed malicious file(s)
Remove-Item "FULL\PATH\TO\FILE.exe" -Force


#Verify file removal
Get-ChildItem "FULL\DIRECTORY\PATH" -Filter "SUSPICIOUS_NAME_*.exe"


#Check system-wide Run registry key for persistence
Get-ItemProperty "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run"


#Check user Run registry key for persistence
Get-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"


#Check for non-Microsoft scheduled tasks (common persistence method)
Get-ScheduledTask | Where-Object { $_.TaskPath -notlike "\Microsoft*" } |
Select-Object TaskName, TaskPath, State


#Check for Windows Defender detections (if applicable)
Get-MpThreatDetection


#Confirm malicious process is no longer running
Get-Process | Where-Object { $_.Name -like "SUSPICIOUS_NAME*" }
